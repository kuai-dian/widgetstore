/**
 * tdesign v0.8.0
 * (c) 2022 tdesign
 * @license MIT
 */

import _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';
import _defineProperty from '@babel/runtime/helpers/defineProperty';
import { isVNode, defineComponent, createVNode, resolveComponent } from 'vue';
import pick from 'lodash/pick';
import { prefix } from '../config.js';
import TransferList from './components/transfer-list.js';
import TransferOperations from './components/transfer-operations.js';
import { TRANSFER_NAME, getTransferData, filterTransferData, getDataValues, getTransferListOption } from './utils.js';
import mixins from '../utils/mixins.js';
import getConfigReceiverMixins from '../config-provider/config-receiver.js';
import props from './props.js';
import { emitEvent } from '../utils/event.js';
import '@babel/runtime/helpers/typeof';
import '../pagination/index.js';
import '../pagination/pagination.js';
import 'tdesign-icons-vue-next';
import '../input-number/index.js';
import '../input-number/input-number.js';
import '@babel/runtime/helpers/asyncToGenerator';
import '@babel/runtime/regenerator';
import '../button/index.js';
import '../button/button.js';
import '../utils/classnames.js';
import '../loading/index.js';
import '../loading/loading.js';
import '@babel/runtime/helpers/slicedToArray';
import '../loading/icon/gradient.js';
import '../_common/js/loading/circle-adapter.js';
import '../_common/js/utils/set-style.js';
import '../_common/js/utils/helper.js';
import '@babel/runtime/helpers/objectWithoutProperties';
import '../utils/dom.js';
import '../_chunks/dep-b66bfe36.js';
import 'lodash/isString';
import '../utils/easing.js';
import '../utils/render-tnode.js';
import 'lodash/isEmpty';
import 'lodash/isFunction';
import 'lodash/isObject';
import '../utils/transfer-dom.js';
import '../loading/props.js';
import '../utils/withInstall.js';
import './style/css.js';
import '../loading/type.js';
import '../loading/plugin.js';
import '../button/props.js';
import '../utils/ripple.js';
import '../utils/set-style.js';
import '../button/type.js';
import '../input-number/props.js';
import '../utils/helper.js';
import 'lodash/camelCase';
import '../utils/map-props.js';
import 'lodash/kebabCase';
import '../input-number/type.js';
import '../select/index.js';
import '../select/select.js';
import 'lodash/debounce';
import 'lodash/get';
import 'lodash/set';
import '../input/index.js';
import '../input/addon.js';
import '../input/input.js';
import '../input/props.js';
import '../config-provider/zh_CN_config.js';
import '../config-provider/type.js';
import '../input/input-group.js';
import '../input/type.js';
import '../tag/index.js';
import '../tag/tag.js';
import '../tag/props.js';
import '../tag/check-tag.js';
import '../tag/check-tag-props.js';
import '../tag/type.js';
import '../common-components/fake-arrow.js';
import '../popup/index.js';
import '../popup/popup.js';
import '@popperjs/core';
import '../popup/props.js';
import '../popup/type.js';
import '../select/option.js';
import '../select/option-props.js';
import '../checkbox/index.js';
import '../checkbox/checkbox.js';
import '../checkbox/props.js';
import '../checkbox/group.js';
import 'lodash/intersection';
import '../checkbox/checkbox-group-props.js';
import '../checkbox/type.js';
import '../select/props.js';
import '../select/optionGroup.js';
import '../select/option-group-props.js';
import '../select/type.js';
import '../pagination/props.js';
import '../pagination/type.js';
import './components/transfer-search.js';
import 'lodash/cloneDeep';

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _isSlot(s) {
  return typeof s === 'function' || Object.prototype.toString.call(s) === '[object Object]' && !isVNode(s);
}

var SOURCE = "source";
var TARGET = "target";
var _Transfer = defineComponent(_objectSpread(_objectSpread({}, mixins(getConfigReceiverMixins("transfer"))), {}, {
  name: TRANSFER_NAME,
  components: {
    TransferList: TransferList,
    TransferOperations: TransferOperations
  },
  props: _objectSpread({}, props),
  emits: ["checkChange", "change", "scroll", "search", "page-change", "update:checked", "checked-change", "update:value"],
  data: function data() {
    return {
      SOURCE: SOURCE,
      TARGET: TARGET
    };
  },
  computed: {
    isTreeMode: function isTreeMode() {
      var treeSlot = this.$slots.tree;
      return typeof treeSlot === "function";
    },
    leftButtonDisabled: function leftButtonDisabled() {
      return this.direction === "right";
    },
    rightButtonDisabled: function rightButtonDisabled() {
      return this.direction === "left";
    },
    transferData: function transferData() {
      return getTransferData(this.data, this.keys, this.isTreeMode);
    },
    sourceList: function sourceList() {
      return filterTransferData(this.transferData, this.value, false, this.isTreeMode);
    },
    targetList: function targetList() {
      return filterTransferData(this.transferData, this.value, true, this.isTreeMode);
    },
    checkedValue: function checkedValue() {
      var _ref;

      return _ref = {}, _defineProperty(_ref, SOURCE, getDataValues(this.sourceList, this.checked, {
        isTreeMode: this.isTreeMode
      })), _defineProperty(_ref, TARGET, getDataValues(this.targetList, this.checked, {
        isTreeMode: this.isTreeMode
      })), _ref;
    },
    hasFooter: function hasFooter() {
      return !!this.$slots.footer || !!this.footer;
    },
    showPagination: function showPagination() {
      return !!this.pagination && !this.$slots.content;
    },
    showSearch: function showSearch() {
      return !!this.search;
    },
    footerOption: function footerOption() {
      var footer = this.footer || "";
      return getTransferListOption(footer);
    },
    emptyOption: function emptyOption() {
      return getTransferListOption(this.empty);
    },
    searchOption: function searchOption() {
      return getTransferListOption(this.search);
    },
    checkAllOption: function checkAllOption() {
      return getTransferListOption(this.showCheckAll);
    },
    disabledOption: function disabledOption() {
      return getTransferListOption(this.disabled);
    },
    titleOption: function titleOption() {
      return getTransferListOption(this.title);
    },
    paginationOption: function paginationOption() {
      return getTransferListOption(this.pagination);
    }
  },
  methods: {
    transferTo: function transferTo(toDirection) {
      var oldTargetValue = JSON.parse(JSON.stringify(this.value));
      var newTargetValue;
      var checkedValue = toDirection === TARGET ? this.checkedValue[SOURCE] : this.checkedValue[TARGET];

      if (toDirection === SOURCE) {
        newTargetValue = oldTargetValue.filter(function (v) {
          return !checkedValue.includes(v);
        });
      } else if (this.targetSort === "original") {
        newTargetValue = getDataValues(this.transferData, oldTargetValue.concat(checkedValue), {
          isTreeMode: this.isTreeMode
        });
      } else if (this.targetSort === "unshift") {
        newTargetValue = checkedValue.concat(oldTargetValue);
      } else {
        newTargetValue = oldTargetValue.concat(checkedValue);
      }

      this.handleCheckedChange([], toDirection === SOURCE ? TARGET : SOURCE);
      var params = {
        type: toDirection,
        movedValue: checkedValue
      };
      emitEvent(this, "change", newTargetValue, params);
    },
    transferToRight: function transferToRight() {
      this.transferTo(TARGET);
    },
    transferToLeft: function transferToLeft() {
      this.transferTo(SOURCE);
    },
    handleCheckedChange: function handleCheckedChange(val, listType) {
      var sourceChecked = listType === SOURCE ? val : this.checkedValue[SOURCE];
      var targetChecked = listType === TARGET ? val : this.checkedValue[TARGET];
      var checked = [].concat(_toConsumableArray(sourceChecked), _toConsumableArray(targetChecked));
      var event = {
        checked: checked,
        sourceChecked: sourceChecked,
        targetChecked: targetChecked,
        type: listType
      };
      this.$emit("update:checked", checked);
      emitEvent(this, "checked-change", event);
    },
    filterMethod: function filterMethod(transferList, targetValueList, needMatch) {
      return transferList.filter(function (item) {
        var isMatch = targetValueList.indexOf(item.value) > -1;
        return needMatch ? isMatch : !isMatch;
      });
    },
    handleScroll: function handleScroll(e, listType) {
      var target = e.target;
      var bottomDistance = target.scrollHeight - target.scrollTop - target.clientHeight;
      var event = {
        e: e,
        bottomDistance: bottomDistance,
        type: listType
      };
      emitEvent(this, "scroll", event);
    },
    handleSearch: function handleSearch(e) {
      emitEvent(this, "search", e);
    },
    handlePageChange: function handlePageChange(pageInfo, listType) {
      emitEvent(this, "page-change", pageInfo, {
        type: listType
      });
    },
    renderTransferList: function renderTransferList(listType) {
      var _this = this;

      var scopedSlots = pick(this.$slots, ["title", "empty", "footer", "operation", "transferItem", "default", "tree"]);
      return createVNode(resolveComponent("transfer-list"), {
        "checkboxProps": this.checkboxProps,
        "transferItem": this.transferItem,
        "list-type": listType,
        "title": this.titleOption[listType],
        "data-source": listType === SOURCE ? this.sourceList : this.targetList,
        "checked-value": this.checkedValue[listType],
        "disabled": this.disabledOption[listType],
        "search": this.searchOption[listType],
        "pagination": this.paginationOption[listType],
        "check-all": this.checkAllOption[listType],
        "footer": this.footerOption[listType],
        "empty": this.emptyOption[listType],
        "onCheckedChange": function onCheckedChange($event) {
          return _this.handleCheckedChange($event, listType);
        },
        "onScroll": function onScroll($event) {
          return _this.handleScroll($event, listType);
        },
        "onSearch": this.handleSearch,
        "onPageChange": function onPageChange($event) {
          return _this.handlePageChange($event, listType);
        },
        "t": this.t,
        "global": this.global,
        "isTreeMode": this.isTreeMode
      }, _isSlot(scopedSlots) ? scopedSlots : {
        "default": function _default() {
          return [scopedSlots];
        }
      });
    }
  },
  render: function render() {
    return createVNode("div", {
      "class": ["".concat(prefix, "-transfer"), this.showSearch ? "".concat(prefix, "-transfer__search") : "", this.hasFooter ? "".concat(prefix, "-transfer__footer") : "", this.showPagination ? "".concat(prefix, "-transfer__pagination") : "", this.isTreeMode ? "".concat(prefix, "-transfer--with-tree") : ""]
    }, [this.renderTransferList(SOURCE), createVNode(resolveComponent("transfer-operations"), {
      "left-disabled": this.disabledOption[TARGET] || this.leftButtonDisabled || this.checkedValue[TARGET].length === 0,
      "right-disabled": this.disabledOption[SOURCE] || this.rightButtonDisabled || this.checkedValue[SOURCE].length === 0,
      "operation": this.operation,
      "onMoveToRight": this.transferToRight,
      "onMoveToLeft": this.transferToLeft
    }, {
      operation: this.$slots.operation
    }), this.renderTransferList(TARGET)]);
  }
}));

export { _Transfer as default };
//# sourceMappingURL=transfer.js.map
